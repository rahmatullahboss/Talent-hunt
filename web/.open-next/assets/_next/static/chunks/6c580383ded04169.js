(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(75157);let s=(0,r.forwardRef)(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("rounded-[var(--radius-lg)] border border-card-border bg-card p-6 shadow-sm shadow-foreground/5",e),...r}));s.displayName="Card",e.s(["Card",0,s])},24687,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(75157);let s=(0,r.forwardRef)(({className:e,...r},s)=>(0,t.jsx)("textarea",{ref:s,className:(0,a.cn)("flex min-h-[120px] w-full rounded-[var(--radius-md)] border border-card-border bg-card px-4 py-3 text-foreground shadow-sm transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent placeholder:text-muted/60 disabled:cursor-not-allowed disabled:opacity-60",e),...r}));s.displayName="Textarea",e.s(["Textarea",0,s])},14141,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(46696),s=e.i(24687),n=e.i(19455);let o=(0,e.i(75254).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var l=e.i(7670);function d({url:e,isCurrent:r}){let{host:a,label:s,initials:n}=function(e){try{let t=new URL(e),r=t.hostname.replace(/^www\./,""),a=`${t.pathname}${t.search}${t.hash}`,s=a&&"/"!==a?decodeURI(a):void 0;return{host:r,label:s??r,initials:r.replace(/[^a-zA-Z0-9]/g,"").slice(0,2).toUpperCase()||r.slice(0,2).toUpperCase()}}catch{return{host:e.replace(/^https?:\/\//,""),label:e,initials:e.slice(0,2).toUpperCase()}}}(e);return(0,t.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:(0,l.default)("group block w-full overflow-hidden rounded-[var(--radius-md)] border text-left shadow-sm transition hover:-translate-y-[1px] hover:shadow-md",r?"border-accent-foreground/20 bg-accent/90 text-accent-foreground":"border-card-border/70 bg-card text-foreground"),children:(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3",children:[(0,t.jsx)("div",{className:(0,l.default)("flex h-10 w-10 shrink-0 items-center justify-center rounded-md text-sm font-semibold",r?"bg-accent-foreground/15 text-accent-foreground":"bg-foreground/10 text-foreground"),children:n}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"truncate text-sm font-medium",children:a}),(0,t.jsx)("p",{className:(0,l.default)("truncate text-xs",r?"text-accent-foreground/80":"text-muted-foreground"),children:s})]}),(0,t.jsx)(o,{className:(0,l.default)("h-4 w-4 shrink-0 transition group-hover:translate-x-[1px] group-hover:-translate-y-[1px]",r?"text-accent-foreground/80":"text-muted-foreground")})]})})}function i({contractId:e,currentUserId:o,participants:l,initialMessages:i}){let[c,u]=(0,r.useState)(i),[f,h]=(0,r.useState)(""),[m,x]=(0,r.useState)(!1),p=(0,r.useRef)(null),g=(0,r.useCallback)(async()=>{try{let t=await fetch(`/api/contracts/${e}/messages`);if(t.ok){let e=await t.json();e.messages&&u(e.messages)}}catch{}},[e]);(0,r.useEffect)(()=>{let e=setInterval(g,5e3);return()=>clearInterval(e)},[g]),(0,r.useEffect)(()=>{p.current?.scrollIntoView({behavior:"smooth"})},[c]);let b=async()=>{if(f.trim()&&!m){x(!0);try{let t=await fetch(`/api/contracts/${e}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:f.trim()})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to send message")}h(""),await g()}catch(t){let e=t instanceof Error?t.message:"Failed to send message";a.toast.error(e)}finally{x(!1)}}};return(0,t.jsxs)("div",{className:"flex h-full flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 space-y-3 overflow-auto rounded-[var(--radius-md)] border border-card-border/70 bg-card/60 p-4",children:[c.map(e=>{let a=e.sender_id===o,s=l.find(t=>t.id===e.sender_id),n=e.content.split(/(https?:\/\/[^\s]+)/g),i=Array.from(new Set(n.filter(e=>e.startsWith("http://")||e.startsWith("https://"))));return(0,t.jsxs)("div",{className:`flex flex-col ${a?"items-end":"items-start"}`,children:[(0,t.jsx)("span",{className:"text-xs text-muted",children:s?.name??"Member"}),(0,t.jsx)("div",{className:`mt-1 max-w-[70%] rounded-[var(--radius-md)] px-3 py-2 text-sm ${a?"bg-accent text-accent-foreground":"bg-foreground/10 text-foreground"}`,children:(0,t.jsx)("p",{className:"whitespace-pre-wrap break-words leading-relaxed",children:n.map((a,s)=>a?a.startsWith("http://")||a.startsWith("https://")?(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"break-words font-medium underline decoration-current underline-offset-2 transition hover:opacity-80",children:a})," "]},`${e.id}-segment-${s}`):(0,t.jsx)("span",{children:a},`${e.id}-segment-${s}`):null)})}),i.length>0?(0,t.jsx)("div",{className:"mt-2 flex w-full max-w-[70%] flex-col gap-2",children:i.map(r=>(0,t.jsx)(d,{url:r,isCurrent:a},`${e.id}-${r}`))}):null,(0,t.jsx)("span",{className:"mt-1 text-[11px] text-muted",children:new Date(e.created_at).toLocaleString()})]},e.id)}),(0,t.jsx)("div",{ref:p})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Textarea,{value:f,onChange:e=>h(e.target.value),rows:3,placeholder:"Share updates, questions, or files (paste link)."}),(0,t.jsx)(n.Button,{onClick:b,loading:m,children:"Send"})]})]})}e.s(["ContractChat",()=>i],14141)}]);