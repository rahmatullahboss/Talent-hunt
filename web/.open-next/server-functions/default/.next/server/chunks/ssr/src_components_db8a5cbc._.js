module.exports=[91119,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(68114);let e=(0,c.forwardRef)(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("rounded-[var(--radius-lg)] border border-card-border bg-card p-6 shadow-sm shadow-foreground/5",a),...c}));e.displayName="Card",a.s(["Card",0,e])},29246,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(68114);let e=(0,c.forwardRef)(({className:a,...c},e)=>(0,b.jsx)("textarea",{ref:e,className:(0,d.cn)("flex min-h-[120px] w-full rounded-[var(--radius-md)] border border-card-border bg-card px-4 py-3 text-foreground shadow-sm transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent placeholder:text-muted/60 disabled:cursor-not-allowed disabled:opacity-60",a),...c}));e.displayName="Textarea",a.s(["Textarea",0,e])},54476,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(23292),e=a.i(29246),f=a.i(99570);let g=(0,a.i(70106).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var h=a.i(98621);function i({url:a,isCurrent:c}){let{host:d,label:e,initials:f}=function(a){try{let b=new URL(a),c=b.hostname.replace(/^www\./,""),d=`${b.pathname}${b.search}${b.hash}`,e=d&&"/"!==d?decodeURI(d):void 0;return{host:c,label:e??c,initials:c.replace(/[^a-zA-Z0-9]/g,"").slice(0,2).toUpperCase()||c.slice(0,2).toUpperCase()}}catch{return{host:a.replace(/^https?:\/\//,""),label:a,initials:a.slice(0,2).toUpperCase()}}}(a);return(0,b.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:(0,h.default)("group block w-full overflow-hidden rounded-[var(--radius-md)] border text-left shadow-sm transition hover:-translate-y-[1px] hover:shadow-md",c?"border-accent-foreground/20 bg-accent/90 text-accent-foreground":"border-card-border/70 bg-card text-foreground"),children:(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3",children:[(0,b.jsx)("div",{className:(0,h.default)("flex h-10 w-10 shrink-0 items-center justify-center rounded-md text-sm font-semibold",c?"bg-accent-foreground/15 text-accent-foreground":"bg-foreground/10 text-foreground"),children:f}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"truncate text-sm font-medium",children:d}),(0,b.jsx)("p",{className:(0,h.default)("truncate text-xs",c?"text-accent-foreground/80":"text-muted-foreground"),children:e})]}),(0,b.jsx)(g,{className:(0,h.default)("h-4 w-4 shrink-0 transition group-hover:translate-x-[1px] group-hover:-translate-y-[1px]",c?"text-accent-foreground/80":"text-muted-foreground")})]})})}function j({contractId:a,currentUserId:g,participants:h,initialMessages:j}){let[k,l]=(0,c.useState)(j),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),q=(0,c.useRef)(null),r=(0,c.useCallback)(async()=>{try{let b=await fetch(`/api/contracts/${a}/messages`);if(b.ok){let a=await b.json();a.messages&&l(a.messages)}}catch{}},[a]);(0,c.useEffect)(()=>{let a=setInterval(r,5e3);return()=>clearInterval(a)},[r]),(0,c.useEffect)(()=>{q.current?.scrollIntoView({behavior:"smooth"})},[k]);let s=async()=>{if(m.trim()&&!o){p(!0);try{let b=await fetch(`/api/contracts/${a}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:m.trim()})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to send message")}n(""),await r()}catch(b){let a=b instanceof Error?b.message:"Failed to send message";d.toast.error(a)}finally{p(!1)}}};return(0,b.jsxs)("div",{className:"flex h-full flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 space-y-3 overflow-auto rounded-[var(--radius-md)] border border-card-border/70 bg-card/60 p-4",children:[k.map(a=>{let d=a.sender_id===g,e=h.find(b=>b.id===a.sender_id),f=a.content.split(/(https?:\/\/[^\s]+)/g),j=Array.from(new Set(f.filter(a=>a.startsWith("http://")||a.startsWith("https://"))));return(0,b.jsxs)("div",{className:`flex flex-col ${d?"items-end":"items-start"}`,children:[(0,b.jsx)("span",{className:"text-xs text-muted",children:e?.name??"Member"}),(0,b.jsx)("div",{className:`mt-1 max-w-[70%] rounded-[var(--radius-md)] px-3 py-2 text-sm ${d?"bg-accent text-accent-foreground":"bg-foreground/10 text-foreground"}`,children:(0,b.jsx)("p",{className:"whitespace-pre-wrap break-words leading-relaxed",children:f.map((d,e)=>d?d.startsWith("http://")||d.startsWith("https://")?(0,b.jsxs)(c.Fragment,{children:[(0,b.jsx)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"break-words font-medium underline decoration-current underline-offset-2 transition hover:opacity-80",children:d})," "]},`${a.id}-segment-${e}`):(0,b.jsx)("span",{children:d},`${a.id}-segment-${e}`):null)})}),j.length>0?(0,b.jsx)("div",{className:"mt-2 flex w-full max-w-[70%] flex-col gap-2",children:j.map(c=>(0,b.jsx)(i,{url:c,isCurrent:d},`${a.id}-${c}`))}):null,(0,b.jsx)("span",{className:"mt-1 text-[11px] text-muted",children:new Date(a.created_at).toLocaleString()})]},a.id)}),(0,b.jsx)("div",{ref:q})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(e.Textarea,{value:m,onChange:a=>n(a.target.value),rows:3,placeholder:"Share updates, questions, or files (paste link)."}),(0,b.jsx)(f.Button,{onClick:s,loading:o,children:"Send"})]})]})}a.s(["ContractChat",()=>j],54476)}];

//# sourceMappingURL=src_components_db8a5cbc._.js.map