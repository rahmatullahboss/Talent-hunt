module.exports=[3622,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(53112),e=a.i(58840),f=a.i(22028),g=a.i(13095);let h=d.z.object({jobId:d.z.string(),coverLetter:d.z.string().min(50,"Cover letter should be at least 50 characters to show your expertise."),bidAmount:d.z.coerce.number().positive("Bid amount must be greater than zero."),bidType:d.z.enum(["fixed","hourly"]),estimatedHours:d.z.preprocess(a=>""===a||null===a?void 0:Number(a),d.z.number().positive().max(1e3).optional())}),i=d.z.object({proposalId:d.z.string()});async function j(a,b){let d=h.safeParse({jobId:b.get("jobId"),coverLetter:b.get("coverLetter"),bidAmount:b.get("bidAmount"),bidType:b.get("bidType"),estimatedHours:b.get("estimatedHours")});if(!d.success)return{status:"error",message:d.error.issues[0]?.message??"Invalid proposal data."};let g=await (0,e.getCurrentUser)();if(!g?.profile||"freelancer"!==g.profile.role)return{status:"error",message:"Only freelancers can submit proposals."};let i=(0,e.getDB)();if(!i)return{status:"error",message:"Database not available."};try{if(await i.prepare("SELECT id FROM proposals WHERE job_id = ? AND freelancer_id = ?").bind(d.data.jobId,g.profile.id).first())return{status:"error",message:"You have already submitted a proposal for this job."};let a=(0,f.generateId)();return await i.prepare(`INSERT INTO proposals (id, job_id, freelancer_id, cover_letter, bid_amount, bid_type, estimated_hours, status)
         VALUES (?, ?, ?, ?, ?, ?, ?, 'submitted')`).bind(a,d.data.jobId,g.profile.id,d.data.coverLetter,d.data.bidAmount,d.data.bidType,"hourly"===d.data.bidType?d.data.estimatedHours??null:null).run(),(0,c.revalidatePath)(`/freelancer/jobs/${d.data.jobId}`),(0,c.revalidatePath)("/freelancer/proposals"),(0,c.revalidatePath)("/freelancer/dashboard"),{status:"success",message:"Proposal submitted successfully!"}}catch(a){return{status:"error",message:a instanceof Error?a.message:"Failed to submit proposal."}}}async function k(a,b){let d=i.safeParse({proposalId:b.get("proposalId")});if(!d.success)return{status:"error",message:"Invalid proposal reference."};let f=await (0,e.getCurrentUser)();if(!f?.profile||"freelancer"!==f.profile.role)return{status:"error",message:"Only freelancers can withdraw proposals."};let g=(0,e.getDB)();if(!g)return{status:"error",message:"Database not available."};try{let a=await g.prepare("SELECT id, job_id, freelancer_id, status FROM proposals WHERE id = ?").bind(d.data.proposalId).first();if(!a||a.freelancer_id!==f.profile.id)return{status:"error",message:"Proposal not found."};if("submitted"!==a.status&&"shortlisted"!==a.status)return{status:"error",message:"Only pending proposals can be withdrawn."};return await g.prepare("UPDATE proposals SET status = 'withdrawn', updated_at = datetime('now') WHERE id = ?").bind(a.id).run(),(0,c.revalidatePath)(`/freelancer/jobs/${a.job_id}`),(0,c.revalidatePath)("/freelancer/proposals"),{status:"success",message:"Proposal withdrawn."}}catch(a){return{status:"error",message:a instanceof Error?a.message:"Failed to withdraw proposal."}}}(0,g.ensureServerEntryExports)([j,k]),(0,b.registerServerReference)(j,"605320a138c7f3f16a1f8a8bd089e0e3cd5452d8bd",null),(0,b.registerServerReference)(k,"60d213bb31704221c0e46ef0c4385c9d96f9c1cb45",null),a.s(["submitProposalAction",()=>j,"withdrawProposalAction",()=>k])},59771,a=>{"use strict";var b=a.i(3622);a.s([],7060),a.i(7060),a.s(["605320a138c7f3f16a1f8a8bd089e0e3cd5452d8bd",()=>b.submitProposalAction],59771)}];

//# sourceMappingURL=_29ccb8dc._.js.map