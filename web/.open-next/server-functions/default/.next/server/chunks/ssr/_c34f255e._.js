module.exports=[57300,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(53112),e=a.i(58840),f=a.i(22028),g=a.i(13095);let h=d.z.object({title:d.z.string().min(5,"Provide a descriptive job title."),description:d.z.string().min(50,"Share enough detail about the project (min 50 characters)."),category:d.z.string().min(2,"Select a category."),budgetMode:d.z.enum(["fixed","hourly"]),budgetMin:d.z.coerce.number().min(0,"Budget must be positive."),budgetMax:d.z.coerce.number().optional(),skills:d.z.string().transform(a=>a.split(",").map(a=>a.trim()).filter(Boolean)).pipe(d.z.array(d.z.string()).min(1,"Add at least one required skill.")),experience:d.z.enum(["entry","mid","expert"]),deadline:d.z.string().optional().transform(a=>a?.length?a:void 0)}),i=d.z.object({jobId:d.z.string(),status:d.z.enum(["draft","open","in_progress","completed","cancelled"])}),j=d.z.object({proposalId:d.z.string(),jobId:d.z.string(),escrowAmount:d.z.coerce.number().optional(),notes:d.z.string().optional()});async function k(a,b){let d=h.safeParse({title:b.get("title"),description:b.get("description"),category:b.get("category"),budgetMode:b.get("budgetMode"),budgetMin:b.get("budgetMin"),budgetMax:b.get("budgetMax"),skills:b.get("skills"),experience:b.get("experience"),deadline:b.get("deadline")});if(!d.success)return{status:"error",message:d.error.issues[0]?.message??"Invalid job post."};let g=await (0,e.getCurrentUser)();if(!g?.profile||"employer"!==g.profile.role)return{status:"error",message:"Only employers can post jobs."};let i=(0,e.getDB)();if(!i)return{status:"error",message:"Database not available."};try{let a=(0,f.generateId)();return await i.prepare(`INSERT INTO jobs (id, employer_id, title, description, category, budget_mode, budget_min, budget_max, skills, experience_level, deadline, status)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'open')`).bind(a,g.profile.id,d.data.title,d.data.description,d.data.category,d.data.budgetMode,d.data.budgetMin,d.data.budgetMax??null,(0,f.toJsonArray)(d.data.skills),d.data.experience,d.data.deadline??null).run(),(0,c.revalidatePath)("/employer/jobs"),(0,c.revalidatePath)("/employer/dashboard"),{status:"success",message:"Job posted successfully."}}catch(a){return{status:"error",message:a instanceof Error?a.message:"Failed to create job."}}}async function l(a,b){let d=i.safeParse({jobId:b.get("jobId"),status:b.get("status")});if(!d.success)return{status:"error",message:"Invalid job status update."};let f=await (0,e.getCurrentUser)();if(!f?.profile||"employer"!==f.profile.role)return{status:"error",message:"Only employers can update job status."};let g=(0,e.getDB)();if(!g)return{status:"error",message:"Database not available."};try{return await g.prepare("UPDATE jobs SET status = ?, updated_at = datetime('now') WHERE id = ? AND employer_id = ?").bind(d.data.status,d.data.jobId,f.profile.id).run(),(0,c.revalidatePath)(`/employer/jobs/${d.data.jobId}`),(0,c.revalidatePath)("/employer/jobs"),(0,c.revalidatePath)("/freelancer/jobs"),{status:"success",message:"Job updated."}}catch(a){return{status:"error",message:a instanceof Error?a.message:"Failed to update job."}}}async function m(a,b){let d=j.safeParse({proposalId:b.get("proposalId"),jobId:b.get("jobId"),escrowAmount:b.get("escrowAmount"),notes:b.get("notes")});if(!d.success)return{status:"error",message:"Invalid hire request."};let g=await (0,e.getCurrentUser)();if(!g?.profile||"employer"!==g.profile.role)return{status:"error",message:"Only employers can hire freelancers."};let h=(0,e.getDB)();if(!h)return{status:"error",message:"Database not available."};try{let a=await h.prepare("SELECT id, freelancer_id, job_id, status, bid_amount, bid_type FROM proposals WHERE id = ?").bind(d.data.proposalId).first();if(!a||a.job_id!==d.data.jobId)return{status:"error",message:"Proposal not found."};if("hired"===a.status)return{status:"error",message:"Proposal is already marked as hired."};let b=await h.prepare("SELECT id, employer_id, status FROM jobs WHERE id = ?").bind(d.data.jobId).first();if(!b||b.employer_id!==g.profile.id)return{status:"error",message:"You do not have access to this job."};let e=(0,f.generateId)();return await h.prepare(`INSERT INTO contracts (id, proposal_id, job_id, employer_id, freelancer_id, status, escrow_amount, notes)
         VALUES (?, ?, ?, ?, ?, 'active', ?, ?)`).bind(e,a.id,b.id,g.profile.id,a.freelancer_id,d.data.escrowAmount??a.bid_amount,d.data.notes??null).run(),await h.prepare("UPDATE proposals SET status = 'hired', updated_at = datetime('now') WHERE id = ?").bind(a.id).run(),await h.prepare("UPDATE jobs SET status = 'in_progress', updated_at = datetime('now') WHERE id = ?").bind(b.id).run(),(0,c.revalidatePath)(`/employer/jobs/${b.id}`),(0,c.revalidatePath)("/employer/contracts"),(0,c.revalidatePath)("/freelancer/dashboard"),{status:"success",message:"Freelancer hired successfully. Contract created."}}catch(a){return{status:"error",message:a instanceof Error?a.message:"Failed to hire freelancer."}}}(0,g.ensureServerEntryExports)([k,l,m]),(0,b.registerServerReference)(k,"6013723fd153e4b9ea29d5bed4fb92c0c4f27f800a",null),(0,b.registerServerReference)(l,"60084f86a98134ef6d99f1feaead09b392088cf2cd",null),(0,b.registerServerReference)(m,"60979ac114dcfd9392f38dc8643e8f15d3a9d59a2c",null),a.s(["createJobAction",()=>k,"hireProposalAction",()=>m,"updateJobStatusAction",()=>l])},67532,a=>{"use strict";var b=a.i(57300);a.s([],39003),a.i(39003),a.s(["6013723fd153e4b9ea29d5bed4fb92c0c4f27f800a",()=>b.createJobAction],67532)}];

//# sourceMappingURL=_c34f255e._.js.map